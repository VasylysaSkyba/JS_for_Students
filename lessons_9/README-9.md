Урок 9. Гра «Знайди скарб»

Мета гри: знайти скарб. Веб-сторінка відображатиме карту, на якій програма випадково вибирає точку, де заховані скарби. Щоразу, коли гравець кликає по карті, програма повідомляє, наскільки він близький до скарбу. При кліку по точці з скарбом (або дуже близько до неї) гра виводить привітання та повідомляє, скільки кліків пішло на пошук.

Проектування гри
Перш ніж писати код, необхідно розібрати загальну структуру гри. Ось список завдань, які потрібно виконати для того, щоб гра адекватно реагувала на кліки по карті:
1. Створити сторінку гри з картинкою (картою скарбів) та місцем, куди будуть виводитись повідомлення для гравця.
2. Вибрати на карті випадкову точку, де захований скарб.
3. Створити обробник кліків. Щоразу, коли гравець кликатиме по карті, обробник повинен:
    1) збільшити лічильник кліків на 1;
    2) обчислити, наскільки далеко місце кліка від місця, де захований скарб;
    3) відобразити на сторінці повідомлення для гравця - "гаряче" або "холодно";
    4) привітати гравця, якщо він клікнув по скарбниці або близько до нього, та повідомити, скільки всього кліків пішло на пошуки.

Створюємо веб-сторінку з HTML-кодом
Розглянемо HTML-код гри. Скористайтеся новим елементом img для відображення карти кладу, а для виведення ігрових повідомлень додамо на сторінку елемент p. Введіть код в новий файл під назвою treasure.html (рис. 1).


///мал1

Елемент img служить для додавання зображень до HTML-документа. На відміну від інших, закриваючий тег img не потрібен. Потрібен лише відкриваючий
тег, який може містити різні атрибути. У рядку 9 додано елемент img. З допомогою атрибутів width і height ми задали ширину і висоту, відповідно, і те, і інше по 400. Це означає, що наше зображення займатиме 400 пікселів завширшки і 400 пікселів заввишки.

Щоб вказати, яке саме зображення потрібне, використовується атрибут src, зі значенням – адреси картинки (рядок 10).
У рядку 11 після img додано порожній елемент p, зі значенням id="distance" (відстань). У цей елемент за допомогою JavaScript програма виводитиме текст підказок, які повідомляють гравцю, наскільки він близький до мети.


Вибір випадкового місця для скарбу
Настав час почати писати JavaScript-код гри. Перше завдання – вибрати на карті випадкове місце для скарбу. Оскільки розмір картки 400 × 400 пікселів, координати її верхнього лівого кута дорівнюють { x: 0, y: 0 }, а координати нижнього правого кута – { x: 399, y: 399}.


Отримання випадкових значень
Щоб вказати на карті скарбів випадкову точку, потрібно вибрати випадкове значення в діапазоні від 0 до 399 для координати x і випадкове значення в тому ж діапазоні для координати y. Для цього напишіть функцію, яка приймає розмір в якості аргументу та повертає випадкове число від 0 до цього розміру (але не включаючи його):


///мал2



Генеруємо випадкове число від 0 до 1 за допомогою Math.random, множимо його на аргумент size і потім використовуємо Math.floor для округлення до найближчого знизу цілого числа. Далі повертаємо отриманий результат із функції. Виклик getRandomNumber(400) поверне випадкове число від 0 до 399, що і потрібно.

Координати скарбу
Тепер використовуємо функцію getRandomNumber для завдання координат скарбу (рис. 3):



///Мал. 3


У фрагменті коду, починаючи з рядка 30, задаються змінні width і height, відповідні ширині та висоті елемента img, який використовується як карти.
У рядку 34 створено об'єкт під назвою target з двома властивостями x та y, що позначають координати скарбу. Значення x та y отримуємо з функції getRandomNumber. Кожен раз при запуску цього коду отримаємо нову довільну позицію на карті. Координати цієї позиції будуть збережені у властивостях x та y змінної target.

Обробник кліків
Обробник кліків – функція, яка буде викликатись кожного разу, коли гравець клікне по карті. 
Почнемо писати цю функцію з наступного коду:

$(“#map”).click(function (event) {
clicks++;

Спочатку ми використовуємо $("#map"), щоб знайти карту (оскільки "map" - це id елемента img), а потім вказуємо оброблювач кліків. Щоразу, коли гравець клікне по карті, почнеться виконання тіла функції між фігурними дужками. Інформація про клік буде передано у функцію через аргумент event. В обробнику потрібно виконати декілька дій: збільшити лічильник кліків, обчислити, наскільки точка кліка віддалена від координат скарбу, та відобразити повідомлення. Перед тим як писати код обробника, створіть змінні та функції, які допоможуть запрограмувати потрібні дії.


Підрахунок кліків
Перше, що має робити обробник, – відстежувати кількість кліків. Для цього знадобиться змінна clicks, яку необхідно створити на початку програми (за межами коду обробника) та присвоїти їй значення 0:

var clics = 0;

У код обробника кліків необхідно включити команду clicks++, щоб збільшувати лічильник щоразу, коли гравець клікне по карті

Для того, щоб з'ясувати близько або далеко біля скарбу клікнув гравець (hot або cold), потрібно знайти відстань між точкою кліка та місцем, де лежить скарб. У цьому нам допоможе функція getDistance (рис. 4):



///Мал. 4



Ця функція приймає лише два аргументи: event і target. Об'єкт event – ​​той самий, що передається обробнику кліків. Саме в ньому міститься інформація про подію. Зокрема, властивості offsetX і offsetY, що зберігають x-і y-координати кліка. Інформацію по горизонтальній відстані між кліком та скарбом містить змінна diffX.
Координати горизонтальної відстані можна отримати шляхом віднімання target.x (x-координата скарбу) від event.offsetX (x-координата кліка). У такий же спосіб можна знайти вертикальну відстань, яка зберігається в змінній diffY. На малюнку 5 показано, як обчислюються diffX та diffY для двох точок.


///мал 5



Використання теореми Піфагора
І, нарешті, можна використати теорему Піфагори, за допомогою якої можна розрахувати відстань між двома точками у коді функції getDistance. 
Ця теорема говорить, що для прямокутного трикутника, де сторони, що прилягають до прямого кута, позначені як a та b; 
діагональна сторона (гіпотенуза) позначена як c, a2 + b2 = c2 (//a2 - а в степені квадрата). Знаючи довжину і a, і b, можна знайти довжину гіпотенузи, взявши квадратний корінь a2 + b2.

У нашому випадку, щоб знайти відстань між кліком та скарбом, розглянемо дві точки як кути прямокутного трикутника.
У функції getDistance змінна diffX – це довжина горизонтальної сторони трикутника, а diffY - довжина вертикальної сторони. Знайти потрібну відстань – значить знайти довжину гіпотенузи. Приклад такого обчислення показаний на малюнку 6.


///мал6


Щоб знайти гіпотенузу, спочатку потрібно звести diffX та diffY у квадрат. Потім складаємо ці значення і витягуємо із суми квадратний корінь за допомогою JavaScript функції Math.sqrt. Цілком формула для обчислення відстані між кліком і скарбом виглядає так:

return Math.sqrt ((diffX * diffY));

Функція getDistance обчислює цей вираз. Відповідно, отримуємо результат.

Повідомлення гравцеві, наскільки він близький до мети
Тепер відома відстань між кліком та скарбом. Залишається тільки створити підказку, яка повідомлятиме гравця, наскільки близько він кликає від скарбу, але без конкретних цифр. Для цього потрібно створити таку функцію getDistanceHint (рис. 7):


///мал7


Ця функція повертає один із рядків залежно від переданої їй відстані до скарбу. Якщо ця відстань менша за 10, вона поверне «You'll burn yourself!». Відстань від 10 до 20 функція поверне Very hot. У міру збільшення відстані функція буде повідомляти про все більший холод, аж до відстані 320 пікселів, починаючи з якого функція повертає рядок "You'll freeze!". Відображати ці повідомлення необхідно, задаючи їх як текстовий вміст елемента p на сторінці. Наступний код обчислить відстань, отримає потрібний рядок з повідомленням та відобразить цей рядок:

var distance = getDistance (event, target);
var distanceHint = getDistanceHint (distance);
$(“#distance”).text(distanceHint);

Спочатку викликається getDistance, зберігаючи повернене значення змінної distance. Потім distance передається у функцію getDistanceHint, щоб отримати відповідний рядок підказки і зберегти її в змінній distanceHint. Код $("#distance").text(distanceHint); знаходить елемент, id якого дорівнює "distance" (елемент p). Потім код змінює його текст на значення distanceHint. Це означає, що кожного разу при натисканні
на карті веб-сторінка повідомляє гравцю, наскільки близько він підійшов до мети.


Перевірка на виграш
Останнім етапом роботи буде перевірка оброблювачем кліків, чи не потрапив гравець у ціль. Оскільки піксель дуже малий, не варто змушувати гравця клікати точно на місці зі скарбом. 
Зарахуємо за перемогу клік на відстані менше восьми пікселів. Цей код перевіряє відстань до скарбу, у разі перемоги повідомляючи про це гравця:

if (distance < 8) {
alert (“Treasure found! Made by clicks: ” + clicks);
}


---------------Код гри-----------------

const getRandomNumber = function (size) { 
    return Math.floor(Math.random() * size);
};

const getDistance = function (event, target) {
    const diffX = event.offsetX - target.x;
    const diffY = event.offsetY - target.y;
    return Math.sqrt((diffX * diffX) + (diffY * diffY));
};

const getDistanceHint = function (distance) {
    if (distance < 10) {
        return "Обпалишся!";
    } else if (distance < 20) {
        return "Дуже гаряче";
    } else if (distance < 40) {
        return "Гаряче";
    } else if (distance < 80) {
        return "Тепло";
    } else if (distance < 160) {
        return "Холодно";
    } else if (distance < 320) {
        return "Дуже холодно";
    } else {
        return "Замерзнеш!";
    }
};

const width = 400;
const height = 400;
const clicks = 0;

const target = {
    x: getRandomNumber(width),
    y: getRandomNumber(height)
};

$("#map").click(function (event) {
    clicks++;
    const distance = getDistance(event, target);
    const distanceHint = getDistanceHint(distance);
    $("#distance").text(distanceHint);
    if (distance < 8) {
        alert("Скарб знайдено! Зроблено кліків: " + clicks);
    }
});


 -------- код гри з коментарями --------------
const getRandomNumber = function (size) {                   //1. Здобути випадкове число від 0 до size-1
return Math.floor(Math.random() * size);
};

const getDistance = function (event, target) {              //7. Розрахувати відстань від кліка (event) до скарбу (target)
const diffX = event.offsetX - target.x;                     // використовувати теорему Піфагора: У прямокутному трикутнику квадрат гіпотенузи   
const diffY = event.offsetY - target.y;                     // дорівнює сумі квадратів катетів c 2 = a 2 + b 2 .
                
return Math.sqrt((diffX * diffX) + (diffY * diffY));         //8. метод sqrt - знаходить квадратний корінь (()+())
};

const getDistanceHint = function (distance) {                //9. Отримати рядок підказки для відстані

if (distance < 10) {
  return "Обпалишся!";
} else if (distance < 20) {
  return "Дуже гаряче";
} else if (distance < 40) {
  return "Гаряче";
} else if (distance < 80) {
  return "Тепло";
} else if (distance < 160) {
  return "Холодно";
} else if (distance < 320) {
  return "Дуже холодно";
} else {
  return "Замерзнеш!";
}
};


const width = 400;                                             //2. Створити змінні
const height = 400;

let clicks = 0;                                                //5. Кількість кліків на початку

const target = {                                               //3. Випадкове розташування скарбу
x: getRandomNumber(width),
y: getRandomNumber(height)
};

$("#map").click(function (event) {                             //4. Додати обробник кліка для елементу img
clicks++;                                                      //6. Збільшити її на 1

const distance = getDistance(event, target);                   //10. Отримати відстань від місця кліка до скарбу
const distanceHint = getDistanceHint(distance);                //11. Перетворити відстань у підказку
$("#distance").text(distanceHint);                             //12. Записати нову підказку в елемент #distance
if (distance < 8) {                                            //13. Якщо клік був достатньо близько, привітати з перемогою
alert("Скарб знайдено! Зроблено кліків: " + clicks);
}
});


///мал8

